<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="replica_task.css">
    <title>Application Form</title>
    <script>
        // JSONBin API Configuration
        const BIN_URL = "your-jsonbin-url";
        const API_KEY = "your-jsonbin-api-key";

        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("DatingForm");

            // Event listener for form submission
            form.addEventListener("submit", async (e) => {
                e.preventDefault(); // Prevent default form submission

                if (validateForm()) {
                    const formData = collectFormData();
                    try {
                        const response = await submitFormData(formData);
                        if (response.ok) {
                            alert("Form submitted successfully!");
                            form.reset();
                            displayData(); // Refresh displayed data
                        } else {
                            alert("Failed to submit form. Please try again.");
                        }
                    } catch (error) {
                        console.error("Error submitting form:", error);
                        alert("An error occurred while submitting the form.");
                    }
                }
            });

            displayData();
        });

        // Function to validate the form
        function validateForm() {
            let isValid = true;

            // Validate all fields
            isValid = validateName() && isValid;
            isValid = validateAddress() && isValid;
            isValid = validateEmail() && isValid;
            isValid = validatePhone() && isValid;
            isValid = validateIQ() && isValid;
            isValid = validateDate() && isValid;
            isValid = validateEssay() && isValid;
            isValid = validateCheckbox() && isValid;

            return isValid;
        }

        // Function to validate Name
        function validateName() {
            const name = document.getElementById("name").value.trim();
            const nameError = document.getElementById("nameError");
            if (name.length < 3 || name.length > 40) {
                nameError.textContent = "Name must be between 3 and 40 characters.";
                return false;
            } else {
                nameError.textContent = "";
                return true;
            }
        }

        // Function to validate Address
        function validateAddress() {
            const address = document.getElementById("address").value.trim();
            const addressError = document.getElementById("addressError");
            if (address.length < 3) {
                addressError.textContent = "Address must be at least 3 characters long.";
                return false;
            } else {
                addressError.textContent = "";
                return true;
            }
        }

        // Function to validate Email
        function validateEmail() {
            const email = document.getElementById("email").value.trim();
            const emailError = document.getElementById("emailError");
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                emailError.textContent = "Please enter a valid email address.";
                return false;
            } else {
                emailError.textContent = "";
                return true;
            }
        }

        // Function to validate Phone
        function validatePhone() {
            const phone = document.getElementById("phone").value.trim();
            const phoneError = document.getElementById("phoneError");
            if (!/^\d{10}$/.test(phone)) {
                phoneError.textContent = "Phone number must be exactly 10 digits.";
                return false;
            } else {
                phoneError.textContent = "";
                return true;
            }
        }

        // Function to validate IQ
        function validateIQ() {
            const iq = document.getElementById("iq").value.trim();
            const iqError = document.getElementById("iqError");
            if (iq < 80 || iq > 200) {
                iqError.textContent = "IQ must be between 80 and 200.";
                return false;
            } else {
                iqError.textContent = "";
                return true;
            }
        }

        // Function to validate Date
        function validateDate() {
            const date = document.getElementById("date").value;
            const dateError = document.getElementById("dateError");
            if (!date) {
                dateError.textContent = "Please select a valid date.";
                return false;
            } else {
                dateError.textContent = "";
                return true;
            }
        }

        // Function to validate Essay
        function validateEssay() {
            const essay = document.getElementById("essay").value.trim();
            const essayError = document.getElementById("essayError");
            if (essay.split(/\s+/).length < 50) {
                essayError.textContent = "Essay must be at least 50 words.";
                return false;
            } else {
                essayError.textContent = "";
                return true;
            }
        }

        // Function to validate Checkbox
        function validateCheckbox() {
            const checkbox = document.querySelector('input[type="checkbox"]:checked');
            const checkboxError = document.getElementById("checkboxError");
            if (!checkbox) {
                checkboxError.textContent = "Please select at least one option.";
                return false;
            } else {
                checkboxError.textContent = "";
                return true;
            }
        }

        // Function to collect form data
        function collectFormData() {
            return {
                name: document.getElementById("name").value,
                address: document.getElementById("address").value,
                email: document.getElementById("email").value,
                phone: document.getElementById("phone").value,
                iq: parseInt(document.getElementById("iq").value),
                gender: document.querySelector('input[name="gender"]:checked').value,
                dateOfProposedOuting: document.getElementById("date").value,
                reasonForDating: document.getElementById("essay").value,
                educationLevelCompleted: document.getElementById("education_level").value,
                hasTattoosOrPiercings: document.getElementById("ch1").checked,
                isMoreThanTwoYearsOlder: document.getElementById("ch2").checked,
                ownsBydTeslaorBmwx9: document.getElementById("ch3").checked,
                worksFullTime: document.getElementById("ch4").checked,
                parentsAreRich: document.getElementById("ch5").checked,
                dateInWellLitLocation: document.getElementById("ch6").checked,
            };
        }

        // Function for submitting form data to JSONBin
        async function submitFormData(formData) {
            return await fetch(BIN_URL, {
                method: "PUT",
                headers: {
                    "Content-Type": "application/json",
                    "X-Master-Key": API_KEY,
                },
                body: JSON.stringify(formData),
            });
        }

        // Function for fetching data and displaying data
        async function displayData() {
            try {
                const response = await fetch(BIN_URL, {
                    method: "GET",
                    headers: {
                        "X-Master-Key": API_KEY,
                    },
                });

                if (response.ok) {
                    const data = await response.json();
                    renderData(data.record);
                } else {
                    console.error("Failed to fetch data.");
                }
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }

        // Function for rendering fetched data
        function renderData(data) {
            const dataContainer = document.getElementById("DatingDisplay");
            dataContainer.innerHTML = "<h2>Fetched Data</h2>";

            const list = document.createElement("ul");
            for (const key in data) {
                if (data.hasOwnProperty(key)) {
                    const listItem = document.createElement("li");
                    listItem.innerHTML = `<strong>${key}:</strong> ${data[key]}`;
                    list.appendChild(listItem);
                }
            }
            dataContainer.appendChild(list);
        }
    </script>
</head>
<body>
    <main id="container">
        <form id="DatingForm">
            <h1>Application For Permission To Date My Daughter</h1>
            <p><b>Note:</b> Form is to be completed at least 21 days prior to the date.</p>

            <fieldset>
                <legend>Personal Details</legend>
                <label for="name">Name:</label>
                <input type="text" name="name" id="name" placeholder="Enter your name" required>
                <span class="error-message" id="nameError"></span>
                <br><br>

                <label for="address">Address:</label>
                <input type="text" name="address" id="address" placeholder="Enter your address" required>
                <span class="error-message" id="addressError"></span>
                <br><br>

                <label for="email">Email:</label>
                <input type="email" name="email" id="email" placeholder="Enter your email" required>
                <span class="error-message" id="emailError"></span>
                <br><br>

                <label for="phone">Phone Number:</label>
                <input type="text" name="number" id="phone" placeholder="Enter 10-digit phone number" required>
                <span class="error-message" id="phoneError"></span>
                <br><br>

                <label for="iq">IQ:</label>
                <input type="number" name="iq" id="iq" placeholder="Enter your IQ">
                <span class="error-message" id="iqError"></span>
                <br><br>

                <label>Gender:</label><br>
                <input type="radio" name="gender" value="male" id="male" checked>
                <label for="male">Male</label><br>
                <br>

                <label for="date">Date of Proposed Outing:</label>
                <input type="date" id="date" name="date" required>
                <span class="error-message" id="dateError"></span>
            </fieldset>

            <br>

            <fieldset>
                <legend>Check All That Apply</legend>
                <label><input type="checkbox" name="tattoos" id="ch1"> I have tattoos and/or piercings</label><br><br>
                <label><input type="checkbox" name="age_difference" id="ch2"> I am more than 2 years older than your daughter</label><br><br>
                <label><input type="checkbox" name="car" id="ch3"> I own a BYD, Tesla or BMW series X9</label><br><br>
                <label><input type="checkbox" name="employment" id="ch4"> I work full-time</label><br><br>
                <label><input type="checkbox" name="wealthy_parents" id="ch5"> My parents are rich</label><br><br>
                <label><input type="checkbox" name="public_location" id="ch6"> Is the date at a well-lit public location?</label><br><br>
                <span class="error-message" id="checkboxError"></span>
            </fieldset>

            <br>

            <fieldset>
                <legend>Educational Details</legend>
                <label for="education_level">Education Level:</label>
                <select id="education_level">
                    <option value="univeristy">University</option>
                    <option value="college">College</option>
                    <option value="high_school">High School</option>
                    <option value="none">None</option>
                </select>
            </fieldset>

            <br>

            <fieldset>
                <legend>Essay Section</legend>
                <label for="essay">In 50 words or more, explain why you want to date my daughter:</label>
                <br>
                <textarea name="essay" id="essay" rows="4" cols="50" placeholder="Enter Text Here" required></textarea>
                <span class="error-message" id="essayError"></span>
                <br><br>

                <p>Upload Police Clearance Certificate, Bank Statement, and Medical Certificates:</p>
                <input type="file" id="file" multiple>
                <span class="error-message" id="fileError"></span>
            </fieldset>

            <br>

            <button type="submit" id="submit">Send Your Application</button>
            <div class="data-container" id="DatingDisplay">
                <h2>Fetched Data</h2>
                <!-- Fetched data will be displayed here -->
            </div>
        </form>
    </main>
</body>
</html>